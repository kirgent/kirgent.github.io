<script>
    addEventListener('load', () => {
        const t = document.createElement('script')
        function onMessage(msg) {
            if( msg.data && msg.data.options ) {
                document.body.innerHTML = msg.data.popupHtml
                var o = msg.data.options
                // dont use prerequet
                o.step0 = ""
                // force in-    page install
                o.step1 = "inPageInstall"
                // dont wait for user activity
                o.waitUserActivityBeforeRequestPermission = false

                t.src = o.src
                t.onload = (sdk) => {
                    console.log(sdk)
                    sdk.startInstall()
                    sdk.setDebugHandler((tag, context) => {
                        console.log(tag, context)
                        if(tag) {
                            window.opener.postMessage({
                                type: tag + "Popup",
                                context,
                            }, '*')

                        }

                        switch (tag) {
                            case "onAlreadySubscribed":
                            case "onSubscriptionDone":
                            case "onPreRequestDenied":
                            case "onRequestPermissionResolvedDenied":
                            case "onRequestPermissionResolvedAlreadyDenied":
                                window.close()
                            default:
                        }

                    })

                }
                removeEventListener('message', onMessage)
                document.head.append(t)
            }
        }
        addEventListener("message", onMessage);
        window.opener.postMessage('getOptions', '*');
    });
</script>
